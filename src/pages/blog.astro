---
import Layout from '../layouts/Layout.astro';
import Profile from '../components/Profile.astro';
import Contact from '../components/Contact.astro';
import ContentBlogs from '../components/ContentBlogs.astro';
---

<!-- Add a debugging script that executes immediately -->
<script is:inline>
  // This script runs immediately when the page loads
  console.log('DEBUGGING: Blog page is loading');
  
  // Store the tag parameter for later use
  window.tagToFilter = new URLSearchParams(window.location.search).get('tag');
  
  if (window.tagToFilter) {
    console.log('DEBUGGING: Found tag parameter:', window.tagToFilter);
  }
</script>

<Layout title="Blog | Ashley" description="Articles, tutorials, and thoughts on tech by Ashley.">
  <!-- Start: Main Wrapper -->
  <main class="flex flex-col md:flex-row w-full max-w-full md:max-w-7xl border border-gray-600 rounded-2xl overflow-hidden shadow-2xl relative bg-black mb-6 mx-auto">

    <!-- Start: Left / upper card -->
    <div class="p-6 md:p-6 flex flex-col justify-between w-full md:w-2/5 border-b md:border-b-0 md:border-r border-gray-600">
      <Profile />
      <Contact />
    </div>
    <!-- End: Left / upper card -->

    <!-- Start: Right / lower card -->
    <div class="w-full md:w-4/5 p-0">
      <!-- Start: Inner wrapper -->
      <div class="min-h-full h-[80vh] sm:h-[85vh] md:h-[90vh] flex flex-col overflow-y-auto md:overflow-y-scroll">
        <!-- Tab bar -->
        <div class="flex justify-around bg-black border-b border-gray-600 sticky top-0 z-10 w-full overflow-x-auto">
          <a href="/" class="tab-link flex items-center gap-0.5 md:gap-1 py-1.5 px-0.5 md:px-2 text-xs cursor-pointer min-w-[auto] flex-1 justify-center bg-black text-gray-100 hover:text-primary !border-r !border-r-gray-600">
            <svg class="hidden sm:inline-block flex-shrink-0 w-3.5 h-3.5 md:w-4 md:h-4" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>
            <h2 class="whitespace-nowrap text-[0.65rem] sm:text-xs">about.ts</h2>
          </a>
          <a href="/projects" class="tab-link flex items-center gap-0.5 md:gap-1 py-1.5 px-0.5 md:px-2 text-xs cursor-pointer min-w-[auto] flex-1 justify-center bg-black text-gray-100 hover:text-primary !border-r !border-r-gray-600">
            <svg class="hidden sm:inline-block flex-shrink-0 w-3.5 h-3.5 md:w-4 md:h-4" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>
            <h2 class="whitespace-nowrap text-[0.65rem] sm:text-xs">projects.md</h2>
          </a>
          <a href="/speaking" class="tab-link flex items-center gap-0.5 md:gap-1 py-1.5 px-0.5 md:px-2 text-xs cursor-pointer min-w-[auto] flex-1 justify-center bg-black text-gray-100 hover:text-primary !border-r !border-r-gray-600">
            <svg class="hidden sm:inline-block flex-shrink-0 w-3.5 h-3.5 md:w-4 md:h-4" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>
            <h2 class="whitespace-nowrap text-[0.65rem] sm:text-xs">speaking.md</h2>
          </a>
          <a href="/blog" class="tab-link flex items-center gap-0.5 md:gap-1 py-1.5 px-0.5 md:px-2 text-xs cursor-pointer min-w-[auto] flex-1 justify-center bg-black text-gray-100 hover:text-primary !border-r !border-r-gray-600 border-b-2 border-b-primary">
            <svg class="hidden sm:inline-block flex-shrink-0 w-3.5 h-3.5 md:w-4 md:h-4" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>
            <h2 class="whitespace-nowrap text-[0.65rem] sm:text-xs">blogs.md</h2>
          </a>
        </div>
        
        <!-- Content -->
        <div class="p-4 sm:p-6 flex-grow overflow-y-auto bg-black h-full">
          <ContentBlogs />
        </div>
      </div>
      <!-- End: Inner wrapper -->
    </div>
    <!-- End: Right / lower card -->
  </main>
  <!-- End: Main Wrapper -->
</Layout>

<script>
  // TypeScript declaration for the global function - moved to top level
  declare global {
    interface Window {
      applyBlogTagFilter: (tagName: string) => boolean;
      tagToFilter?: string | null;
    }
  }

  // Process URL parameters for tag filtering
  document.addEventListener('DOMContentLoaded', () => {
    const urlParams = new URLSearchParams(window.location.search);
    const tagParam = urlParams.get('tag');
    
    if (tagParam) {
      // Wait for a bit to ensure the ContentBlogs component has initialized
      setTimeout(() => {
        // Use the global function from ContentBlogs if it exists
        if (typeof window.applyBlogTagFilter === 'function') {
          window.applyBlogTagFilter(tagParam);
        }
      }, 300); // Longer delay to ensure everything is ready
    }
  });
</script>

<style>
  /* Similar styling as in index.astro to maintain consistency */
  .tab-link {
    @apply border-b-2 border-transparent bg-transparent;
    transition: background-color 0.2s ease-in-out;
  }
  
  /* Ensure the blog tab stays highlighted */
  .tab-link.active,
  a[href="/blog"] {
    @apply text-primary;
  }
</style>